local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

local Names = {"heart", "find heart", "devil heart"}
local Keep = 1800
local Notify = true
local ShowDist = true

local Gui = Instance.new("ScreenGui")
Gui.Name = "UNIVERSAL_HEART_ESP"
Gui.ResetOnSpawn = false
Gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Btn = Instance.new("TextButton")
Btn.Size = UDim2.fromOffset(100,30)
Btn.Position = UDim2.new(0,10,0,10)
Btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
Btn.TextColor3 = Color3.new(1,1,1)
Btn.Text = "ESP: ON"
Btn.Font = Enum.Font.GothamBold
Btn.TextSize = 14
Btn.Parent = Gui

local Enabled = true
Btn.MouseButton1Click:Connect(function()
	Enabled = not Enabled
	Btn.Text = Enabled and "ESP: ON" or "ESP: OFF"
end)

local Tracked = {}

local function match(n)
	n = string.lower(tostring(n))
	for _,v in ipairs(Names) do
		if string.find(n,v,1,true) then return true end
	end
end

local function isRenderable(inst)
	return inst:IsA("BasePart") or inst:IsA("UnionOperation") or inst:IsA("MeshPart")
end

local function findPart(obj)
	if obj:IsA("Model") then
		return obj.PrimaryPart or obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
	elseif isRenderable(obj) then
		return obj
	end
end

local function track(inst)
	if Tracked[inst] then return end
	local p = findPart(inst)
	if not p then return end
	local t = os.clock()
	local h = Instance.new("Highlight")
	h.Adornee = inst
	h.FillColor = Color3.fromRGB(255,60,60)
	h.FillTransparency = 0.5
	h.OutlineColor = Color3.fromRGB(255,255,255)
	h.Parent = inst
	local bb = Instance.new("BillboardGui")
	bb.Size = UDim2.fromOffset(200,50)
	bb.AlwaysOnTop = true
	bb.StudsOffset = Vector3.new(0,3,0)
	bb.Parent = p
	local f = Instance.new("Frame",bb)
	f.Size = UDim2.fromScale(1,1)
	f.BackgroundColor3 = Color3.fromRGB(40,0,0)
	f.BackgroundTransparency = 0.2
	local txt = Instance.new("TextLabel",f)
	txt.Size = UDim2.fromScale(1,1)
	txt.BackgroundTransparency = 1
	txt.TextColor3 = Color3.fromRGB(255,255,255)
	txt.TextStrokeTransparency = 0.4
	txt.Font = Enum.Font.GothamBold
	txt.TextScaled = true
	Tracked[inst] = {added=t,bb=bb,h=h,text=txt,part=p}
	if Notify then
		pcall(function()
			StarterGui:SetCore("SendNotification",{Title="ðŸ’– ESP",Text="Item detectado: "..inst.Name,Duration=3})
		end)
	end
end

local function clean(inst)
	local t = Tracked[inst]
	if t then
		if t.bb then t.bb:Destroy() end
		if t.h then t.h:Destroy() end
		Tracked[inst]=nil
	end
end

RunService.RenderStepped:Connect(function()
	if not Enabled then
		for i,v in pairs(Tracked) do
			if v.h then v.h.Enabled=false end
			if v.bb then v.bb.Enabled=false end
		end
		return
	end
	local hrp = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	for i,v in pairs(Tracked) do
		if not i or not i.Parent then
			clean(i)
		else
			if v.h then v.h.Enabled=true end
			if v.bb then v.bb.Enabled=true end
			if Keep>0 and os.clock()-v.added>Keep then
				clean(i)
			elseif ShowDist and hrp and v.part then
				local d = (v.part.Position-hrp.Position).Magnitude
				v.text.Text = string.format("ðŸ’– %s | %.0f studs",i.Name,d)
			else
				v.text.Text = "ðŸ’– "..i.Name
			end
		end
	end
end)

local function scan(obj)
	if match(obj.Name) and findPart(obj) then track(obj) end
	for _,d in ipairs(obj:GetDescendants()) do
		if match(d.Name) and findPart(d) then track(d) end
	end
end

workspace.DescendantAdded:Connect(function(d)
	if Enabled and match(d.Name) then track(d) end
end)

for _,d in ipairs(workspace:GetDescendants()) do
	if match(d.Name) then track(d) end
end
